#!/bin/bash
set -euo pipefail

case "${DEBUG:-}" in
  true|1|yes|on)
    set -x
    ;;
esac

# Brewfile hash: {{ include "dot_config/homebrew/Brewfile" | sha256sum }}

export XDG_CONFIG_HOME="${HOME}/.config"

{{ if eq .chezmoi.os "linux" }}
BREW_PREFIX="/home/linuxbrew/.linuxbrew"
{{ else if eq .chezmoi.os "darwin" }}
BREW_PREFIX="/opt/homebrew"
{{ end }}
eval "$(${BREW_PREFIX}/bin/brew shellenv)"

echo "[+] Installing tools with brew bundle..."
brew bundle --file="$XDG_CONFIG_HOME/homebrew/Brewfile" || true
echo "[+] Cleaning up unmanaged brew packages..."
brew bundle cleanup --file="$XDG_CONFIG_HOME/homebrew/Brewfile" --force || true
echo "[âœ“] brew bundle complete"