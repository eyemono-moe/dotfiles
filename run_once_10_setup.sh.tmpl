#!/bin/bash
set -euo pipefail

case "${DEBUG:-}" in
  true|1|yes|on)
    set -x
    ;;
esac

{{ if eq .chezmoi.os "linux" }}
echo -e "\033[1;34m[INFO]\033[0m    Installing dependencies..."
sudo apt update
sudo apt install -y \
  build-essential \
  ca-certificates \
  curl \
  git \
  gnupg \
  lsb-release \
  zsh
echo -e "\033[1;32m[SUCCESS]\033[0m dependencies installed"
{{ end }}

# install Homebrew
if ! command -v brew &>/dev/null; then
  echo -e "\033[1;34m[INFO]\033[0m    Installing Homebrew..."
  NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  echo -e "\033[1;32m[SUCCESS]\033[0m Homebrew installed"
fi

# set zsh as the default shell
if command -v zsh &>/dev/null; then
  echo -e "\033[1;34m[INFO]\033[0m    Setting default shell to zsh..."
  command -v chsh >/dev/null && sudo chsh $USER -s "$(command -v zsh)" || true
fi

echo -e "\033[1;32m[SUCCESS]\033[0m setup complete"